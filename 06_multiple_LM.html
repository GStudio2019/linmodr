<!DOCTYPE html>
<html>
<head>
  <title>Множественная регрессия</title>

  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="generator" content="pandoc" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <link rel="stylesheet" media="all" href="site_libs/ioslides-13.5.1/fonts/fonts.css">

  <link rel="stylesheet" media="all" href="site_libs/ioslides-13.5.1/theme/css/default.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="site_libs/ioslides-13.5.1/theme/css/phone.css">

  <base target="_blank">

  <script type="text/javascript">
    var SLIDE_CONFIG = {
      // Slide settings
      settings: {
                title: 'Множественная регрессия',
                        subtitle: 'Линейные модели, дисперсионный и регрессионный анализ с использованием R, осень 2015',
                useBuilds: true,
        usePrettify: true,
        enableSlideAreas: true,
        enableTouch: true,
                        favIcon: '06_multiple_LM_files/logo.png',
              },

      // Author information
      presenters: [
            {
        name:  'Вадим Хайтов, Марина Варфоломеева' ,
        company: '',
        gplus: '',
        twitter: '',
        www: '',
        github: ''
      },
            ]
    };
  </script>

  <style type="text/css">

    b, strong {
      font-weight: bold;
    }

    em {
      font-style: italic;
    }

    slides > slide {
      -webkit-transition: all 0.4s ease-in-out;
      -moz-transition: all 0.4s ease-in-out;
      -o-transition: all 0.4s ease-in-out;
      transition: all 0.4s ease-in-out;
    }

    .auto-fadein {
      -webkit-transition: opacity 0.6s ease-in;
      -webkit-transition-delay: 0.4s;
      -moz-transition: opacity 0.6s ease-in 0.4s;
      -o-transition: opacity 0.6s ease-in 0.4s;
      transition: opacity 0.6s ease-in 0.4s;
      opacity: 0;
    }

    slides > slide:not(.nobackground):before {
      font-size: 12pt;
      content: "";
      position: absolute;
      bottom: 20px;
      left: 60px;
      background: url(06_multiple_LM_files/logo.png) no-repeat 0 50%;
      -webkit-background-size: 30px 30px;
      -moz-background-size: 30px 30px;
      -o-background-size: 30px 30px;
      background-size: 30px 30px;
      padding-left: 40px;
      height: 30px;
      line-height: 1.9;
    }
  </style>

  <link rel="stylesheet" href="my_styles.css" type="text/css" />

</head>

<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
        <aside class="gdbar"><img src="06_multiple_LM_files/logo.png"></aside>
        <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p data-config-presenter><!-- populated from slide_config.json --></p>
          </hgroup>
  </slide>

<slide class=''><hgroup><h2>Мы рассмотрим</h2></hgroup><article  id="-">

<ul>
<li>Технику подгонки множественных регрессионных моделей</li>
<li>Процесс валидации множественных регрессионных моделей</li>
</ul>

</article></slide><slide class=''><hgroup><h2>Вы сможете</h2></hgroup><article  id="-">

<ul>
<li>Подобрать множественную линейную модель</li>
<li>Протестировать ее статистическую значимость и валидность</li>
</ul>

</article></slide><slide class='segue dark nobackground level1'><hgroup class = 'auto-fadein'><h2>Какие факторы определяют обилие птиц во фрагментированных лесных массивах Австралии?</h2></hgroup><article  id="---------">

</article></slide><slide class=''><hgroup><h2>Читаем данные</h2></hgroup><article  id="-">

<pre class = 'prettyprint lang-r'>bird &lt;- read.csv(&quot;data/loyn.csv&quot;)
head(bird)</pre>

<pre >##   ABUND AREA YRISOL DIST LDIST GRAZE ALT
## 1   5.3  0.1   1968   39    39     2 160
## 2   2.0  0.5   1920  234   234     5  60
## 3   1.5  0.5   1900  104   311     5 140
## 4  17.1  1.0   1966   66    66     3 160
## 5  13.8  1.0   1918  246   246     5 140
## 6  14.1  1.0   1965  234   285     3 130</pre>

</article></slide><slide class=''><hgroup><h2>Знакомимся с даными</h2></hgroup><article  id="--" class="smaller columns-2">

<p><img src="images/Australia.png" width="400" height="400" ></p>

<p>(Пример взять из книги Quinn&amp;Keugh,2002; Оригинальная работа Loyn, 1987)</p>

<p>Фрагментация лесных местообитаний - одна из важнейших проблем Австралии. Вопрос: от каких факторов зависит обилие птиц во фрагментированных лесных массивах?</p>

<p><em>Зависимая перменная</em><br/><code>ABUND</code> - Обилие птиц на стандартном маршруте</p>

<p><em>Предикторы</em><br/><code>AREA</code> - площадь лесного массива (Га)<br/><code>YRISOL</code> - год, в котором произошла изоляция лесного массива<br/><code>DIST</code> - расстояние до ближайшего другого лесного массива (км)<br/><code>LDIST</code> - расстояние до ближайшего более крупного массива (км)<br/><code>GRAZE</code> - качественная оценка уровня выпаса скота (1 - низкий уровень, 5 - высокий урвень)<br/><code>ALT</code> - высота над уровнем моря (м)</p>

</article></slide><slide class=''><hgroup><h2>Можно ли ответить на вопрос таким методом?</h2></hgroup><article  id="------">

<pre class = 'prettyprint lang-r'>cor(bird)</pre>

<pre >##          ABUND     AREA   YRISOL   DIST   LDIST  GRAZE    ALT
## ABUND   1.0000  0.25597  0.50336  0.236  0.0872 -0.683  0.386
## AREA    0.2560  1.00000 -0.00149  0.108  0.0346 -0.310  0.388
## YRISOL  0.5034 -0.00149  1.00000  0.113 -0.0833 -0.636  0.233
## DIST    0.2361  0.10834  0.11322  1.000  0.3172 -0.256 -0.110
## LDIST   0.0872  0.03458 -0.08332  0.317  1.0000 -0.028 -0.306
## GRAZE  -0.6825 -0.31040 -0.63557 -0.256 -0.0280  1.000 -0.407
## ALT     0.3858  0.38775  0.23272 -0.110 -0.3060 -0.407  1.000</pre>

</article></slide><slide class=''><hgroup><h2>Взаимосвязь между переменными может находиться под контролем других переменых и их взаимодействий.</h2></hgroup><article  id="-----------.">

<h3>Необходимо учесть все взаимовлияния в одном анализе</h3>

</article></slide><slide class=''><hgroup><h2>Нам предстоит построить множественную регрессионную модель</h2></hgroup><article  id="-----">

<p>\[y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \beta_3x_{i3} + ... + \beta_px_{ip} + \epsilon_i\]</p>

<ul>
<li><p>\(y_i\) - значение зависимой переменной \(Y\) при значении предикторов \(X_1 = x_{i,1}\), \(X_2 = x_{i,2}\) и т.д.</p></li>
<li>\(\beta_0\) - свободный член (intercept). Значение \(Y\) при \(X_1=X_2=X_3=....=X_p=0\)<br/></li>
<li><p>\(\beta_1\) - частный угловой коэффициент для зависимости \(Y\) от \(X_1\). Показывает насколько единиц изменяется \(Y\) при изменении \(X_1\) на одну единицу и при условии, что все остальные предикторы не изменяются. \(\beta_2\), \(\beta_3\), &#8230;., \(\beta_p\) - аналогично</p></li>
<li><p>\(\epsilon_i\) - варьирование \(Y\), не объясняемое данной моделью.</p></li>
</ul>

</article></slide><slide class=''><hgroup><h2>Геометрическая интерпретация множественной линейной модели</h2></hgroup><article  id="----">

<h3>Для случая с одним предиктором \(y_i = \beta_0 + \beta_1x_i + \epsilon_i\) - линия регрессии</h3>

<p><img src="06_multiple_LM_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=''><hgroup><h2>Геометрическая интерпретация множественной линейной модели</h2></hgroup><article  id="-----1" class="columns-2">

<h3>Для случая с двумя предикторами</h3>

<p>\[y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \epsilon_i\]</p>

<p>Плоскость в трехмерном пространстве</p>

<p><img src="06_multiple_LM_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;" /></p>

</article></slide><slide class=''><hgroup><h2>Геометрическая интерпретация множественной линейной модели</h2></hgroup><article  id="-----2">

<h3>Для случая с большим количеством предикторов</h3>

<p>\[y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \beta_3x_{i3} + ... + \beta_px_{ip} + \epsilon_i\] Плоскость в n-мерном пространстве, оси которого образованы значениями предикторов</p>

</article></slide><slide class=''><hgroup><h2>Исследование данных (Data Exploration)</h2></hgroup><article  id="--data-exploration" class="smaller">

<pre class = 'prettyprint lang-r'>library(car)
scatterplotMatrix(bird)</pre>

<p><img src="06_multiple_LM_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=''><hgroup><h2>Явные проблемы</h2></hgroup><article  id="-">

<h3>Есть сильные корреляции между некоторым предикторами.</h3>

<p><img src="06_multiple_LM_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=''><hgroup><h2>Постоим линейную модель</h2></hgroup><article  id="--">

<h3>Задание. Напишите самостоятельно R код, необходимый для подбора уравнения множественной регрессии</h3>

<p><em>Hint</em></p>

<pre class = 'prettyprint lang-r'>head(bird, 2)</pre>

<pre >##   ABUND AREA YRISOL DIST LDIST GRAZE ALT
## 1   5.3  0.1   1968   39    39     2 160
## 2   2.0  0.5   1920  234   234     5  60</pre>

</article></slide><slide class=''><hgroup><h2>Решение</h2></hgroup><article >

<pre class = 'prettyprint lang-r'>model &lt;- lm(ABUND ~  AREA + YRISOL + DIST + LDIST + GRAZE + ALT, data = bird)

model &lt;- lm(ABUND ~  . , data = bird)</pre>

</article></slide><slide class=''><hgroup><h2>Смотрим на полученную модель</h2></hgroup><article  id="---" class="smaller">

<pre class = 'prettyprint lang-r'>summary(model)</pre>

<pre >## 
## Call:
## lm(formula = ABUND ~ ., data = bird)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -17.664  -4.641  -0.088   4.286  20.104 
## 
## Coefficients:
##                Estimate  Std. Error t value Pr(&gt;|t|)   
## (Intercept) -109.696233  113.349038   -0.97   0.3379   
## AREA           0.000887    0.004657    0.19   0.8498   
## YRISOL         0.066928    0.056843    1.18   0.2447   
## DIST           0.003811    0.005418    0.70   0.4851   
## LDIST          0.001418    0.001310    1.08   0.2845   
## GRAZE         -3.446640    1.106683   -3.11   0.0031 **
## ALT            0.047722    0.030888    1.54   0.1288   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.95 on 49 degrees of freedom
## Multiple R-squared:  0.512,  Adjusted R-squared:  0.452 
## F-statistic: 8.56 on 6 and 49 DF,  p-value: 0.00000224</pre>

</article></slide><slide class='segue dark nobackground level1'><hgroup class = 'auto-fadein'><h2>Проверка валидности модели</h2></hgroup><article  id="--">

</article></slide><slide class=''><hgroup><h2>Вспомним условия применимости линейных моделей</h2></hgroup><article  id="----">

<ol>
<li>Линейность связи между зависимой перменной (\(Y\)) и предикторами (\(X\))</li>
<li>Независимость \(Y\) друг от друга</li>
<li>Нормальное распределение \(Y\) для каждого уровня значенй \(X\)</li>
<li>Гомогенность дисерсии \(Y\) в пределах всех уровней значений \(X\)</li>
<li>Отсутствие коллинеарности предикторов (для можественной регрессии)</li>
</ol>

</article></slide><slide class=''><hgroup><h2>Для начала выясним нет ли среди наблюдений влияющих наблюдений</h2></hgroup><article  id="--------">

<pre class = 'prettyprint lang-r'>library(ggplot2)
ABUND_diag &lt;- fortify(model)
# При жестком подходе D &gt; 4 / (N - p - 1)
# При более мягком подходе D &gt; 1

ggplot(ABUND_diag, aes(x = .fitted, y = .stdresid)) + 
  geom_point(aes(size = .cooksd)) + 
  geom_smooth(se=FALSE) + 
  geom_hline(aes(yintercept = 0))</pre>

<p><img src="06_multiple_LM_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=''><hgroup><h2>Проверяем распределение остатков на соответствие нормальному распределению</h2></hgroup><article  id="------">

<pre class = 'prettyprint lang-r'>ggplot(ABUND_diag, aes(x = .resid)) + geom_histogram(binwidth = 5) </pre>

<p><img src="06_multiple_LM_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=''><hgroup><h2>Проверяем распределение остатков на соответствие нормальному распределению</h2></hgroup><article  id="-------1">

<pre class = 'prettyprint lang-r'>library(car)
qqPlot(model)</pre>

<p><img src="06_multiple_LM_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=''><hgroup><h2>Проверяем на гетероскедастичность</h2></hgroup><article  id="--">

<p><img src="06_multiple_LM_files/figure-html/unnamed-chunk-13-1.png" width="480" style="display: block; margin: auto;" /></p>

<pre class = 'prettyprint lang-r'>library(lmtest)
bptest(model)</pre>

<pre >## 
##  studentized Breusch-Pagan test
## 
## data:  model
## BP = 5, df = 6, p-value = 0.6</pre>

</article></slide><slide class=''><hgroup><h2>Проверяем на мультиколлинеарность</h2></hgroup><article  id="--">

<p><em>Мультиколлинеарность</em> - наличие линейной зависимости между независимыми переменными (факторами) регрессионной модели.</p>

<p>При наличии мультиколлинеарности оценки параметров получаются неточными, а значит сложно будет дать интерпретацию влияния тех или иных факторов на объясняемую переменную</p>

<p>Признаки мультиколлинеарности:<br/>+ Большие ошибки оценок параметров<br/>+ Большинство оценок параметров модели недостоверно, но F критерий всей модели свидетельствует о ее статистической значимости</p>

</article></slide><slide class=''><hgroup><h2>Фактор инфляции дисперсии (Variance inflation factor)</h2></hgroup><article  id="---variance-inflation-factor">

<h3>Фактор инфляции дисперсии (VIF) — мера мультиколлинеарности.</h3>

<pre class = 'prettyprint lang-r'>vif(model)</pre>

<pre >##   AREA YRISOL   DIST  LDIST  GRAZE    ALT 
##   1.34   1.84   1.23   1.26   2.31   1.57</pre>

</article></slide><slide class=''><hgroup><h2>Логика вычисления VIF</h2></hgroup><article  id="--vif">

<p>Мы подбираем модель, описывающую связь данного предиктора со всеми остальными предикторами.</p>

<ol>
<li><p>Строим регрессионную модель.<br/>\[x_1 = c_0 + c_2x_2 +c_2x_3 + .... + c_px_p\]</p></li>
<li><p>Находим \(R^2\) для данной модели.</p></li>
<li><p>Вычисляем фактор инфляции дисперсии. \[VIF = \frac{1}{1-R^2}\]</p></li>
</ol>

</article></slide><slide class=''><hgroup><h2>Что делать, если мультиколлинеарность выявлена?</h2></hgroup><article  id="----">

<p>Решение № 1. Удалить из модели избыточные предикторы<br/>1. Последовательно удалить из модели предикторы с VIF &gt; 5 (сначала предиктор с самым большим VIF)<br/>2. Вновь провести вычисление VIF 3. Если остались еще предикторы с VIF &gt; 5, то повторить шаг 1 и 2. 4. Возможно, придется удалить и предикторы с VIF &gt; 3<br/>5. Иногда полезно удалить и предикторы с VIF &gt; 2 (Это позволит сократить набор предикторов, но не увлекайтесь!)</p>

</article></slide><slide class=''><hgroup><h2>Что делать если мультиколлинеарность выявлена?</h2></hgroup><article  id="-----1">

<p>Решение № 2. Заменить исходные предикторы новыми переменными, полученными с помощью метода главных компонент</p>

</article></slide><slide class=''><hgroup><h2>В нашей модели явной мультколлинеарности нет!</h2></hgroup><article  id="-----">

<h3>Однако, возможно, что <code>GRAZE</code> - избыточный предиктор</h3>

</article></slide><slide class=''><hgroup><h2>Удалим из модели избыточный предиктор</h2></hgroup><article  id="----">

<pre class = 'prettyprint lang-r'>model2 &lt;- update(model, ~ . -GRAZE)
vif(model2)</pre>

<pre >##   AREA YRISOL   DIST  LDIST    ALT 
##   1.25   1.10   1.16   1.24   1.43</pre>

</article></slide><slide class=''><hgroup><h2>Смотрим на итоги</h2></hgroup><article  id="--" class="smaller">

<pre class = 'prettyprint lang-r'>summary(model2)</pre>

<pre >## 
## Call:
## lm(formula = ABUND ~ AREA + YRISOL + DIST + LDIST + ALT, data = bird)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.636  -5.211  -0.277   4.735  22.963 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -344.79073   91.61744   -3.76  0.00044 ***
## AREA           0.00459    0.00488    0.94  0.35132    
## YRISOL         0.17928    0.04760    3.77  0.00044 ***
## DIST           0.00772    0.00571    1.35  0.18233    
## LDIST          0.00192    0.00141    1.36  0.17978    
## ALT            0.07638    0.03195    2.39  0.02062 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 8.61 on 50 degrees of freedom
## Multiple R-squared:  0.415,  Adjusted R-squared:  0.357 
## F-statistic:  7.1 on 5 and 50 DF,  p-value: 0.000044</pre>

</article></slide><slide class=''><hgroup><h2>Сравним две модели</h2></hgroup><article  id="--">

<pre class = 'prettyprint lang-r'>summary(model)$adj.r.squared</pre>

<pre >## [1] 0.452</pre>

<pre class = 'prettyprint lang-r'>summary(model2)$adj.r.squared</pre>

<pre >## [1] 0.357</pre>

<p><em>Удаление этого предиктора, скорее, ухудшает модель!</em></p>

</article></slide><slide class=''><hgroup><h2>Задание:</h2></hgroup><article >

<h3>Постройте и проанализируйте модель, описывающую связь между усилием мышц, осуществляющих выдох (<code>pemax</code>) и следующими параметрами тела</h3>

<p><code>age</code> - Возраст<br/><code>sex</code> - Пол (0: male, 1:female)<br/><code>height</code> - Рост (cm).<br/><code>weight</code> - Вес (kg).<br/><code>bmp</code> - Отклонения в весе от нормы (% of normal).<br/><code>fev1</code> - Объем наполенных легких.<br/><code>rv</code> - Остаточный объем легких.<br/><code>frc</code> - Функциональная остаточная емкость легких.<br/><code>tlc</code> - Общая емкость легких.</p>

<p>Для получения данных выполните следующий код</p>

<pre class = 'prettyprint lang-r'>library(ISwR)
data(cystfibr)</pre>

</article></slide><slide class=''><hgroup><h2>Решение</h2></hgroup><article  id="-1" class="smaller">

<pre class = 'prettyprint lang-r'>M1 &lt;- lm(pemax ~ ., data = cystfibr)
summary(M1)</pre>

<pre >## 
## Call:
## lm(formula = pemax ~ ., data = cystfibr)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -37.34 -11.53   1.08  13.39  33.41 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)  176.058    225.891    0.78     0.45
## age           -2.542      4.802   -0.53     0.60
## sex           -3.737     15.460   -0.24     0.81
## height        -0.446      0.903   -0.49     0.63
## weight         2.993      2.008    1.49     0.16
## bmp           -1.745      1.155   -1.51     0.15
## fev1           1.081      1.081    1.00     0.33
## rv             0.197      0.196    1.00     0.33
## frc           -0.308      0.492   -0.63     0.54
## tlc            0.189      0.500    0.38     0.71
## 
## Residual standard error: 25.5 on 15 degrees of freedom
## Multiple R-squared:  0.637,  Adjusted R-squared:  0.42 
## F-statistic: 2.93 on 9 and 15 DF,  p-value: 0.032</pre>

</article></slide><slide class=''><hgroup><h2>Явные признаки мультиколлинеарности</h2></hgroup><article  id="--">

<pre class = 'prettyprint lang-r'>vif(M1)</pre>

<pre >##    age    sex height weight    bmp   fev1     rv    frc    tlc 
##  21.83   2.27  13.95  47.78   7.12   5.42  10.54  17.14   2.66</pre>

</article></slide><slide class=''><hgroup><h2>Удаляем избыточные предикторы</h2></hgroup><article  id="--">

<pre class = 'prettyprint lang-r'>M2 &lt;- update(M1, .~.-weight)
vif(M2)</pre>

<pre >##    age    sex height    bmp   fev1     rv    frc    tlc 
##   8.10   2.03   7.60   2.73   4.21  10.33  15.81   2.18</pre>

</article></slide><slide class=''><hgroup><h2>Удаляем избыточные предикторы</h2></hgroup><article  id="---1">

<pre class = 'prettyprint lang-r'>M3 &lt;- update(M2, . ~. - frc)
vif(M3)</pre>

<pre >##    age    sex height    bmp   fev1     rv    tlc 
##   7.34   1.61   7.60   1.79   2.87   2.84   1.77</pre>

</article></slide><slide class=''><hgroup><h2>Удаляем избыточные предикторы</h2></hgroup><article  id="---2">

<pre class = 'prettyprint lang-r'>M4 &lt;- update(M3, . ~. - height)
vif(M4)</pre>

<pre >##  age  sex  bmp fev1   rv  tlc 
## 1.61 1.61 1.72 2.86 2.81 1.77</pre>

</article></slide><slide class=''><hgroup><h2>Смотрим на полученную модель</h2></hgroup><article  id="----1" class="smaller">

<pre class = 'prettyprint lang-r'>summary(M4)</pre>

<pre >## 
## Call:
## lm(formula = pemax ~ age + sex + bmp + fev1 + rv + tlc, data = cystfibr)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -50.45 -19.11   3.97  17.40  31.33 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  -83.525     82.808   -1.01   0.3265   
## age            5.038      1.296    3.89   0.0011 **
## sex            4.991     12.913    0.39   0.7037   
## bmp           -0.403      0.564   -0.71   0.4840   
## fev1           1.931      0.780    2.48   0.0234 * 
## rv             0.114      0.101    1.13   0.2745   
## tlc            0.465      0.405    1.15   0.2654   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 25.3 on 18 degrees of freedom
## Multiple R-squared:  0.571,  Adjusted R-squared:  0.428 
## F-statistic: 3.99 on 6 and 18 DF,  p-value: 0.0103</pre>

</article></slide><slide class=''><hgroup><h2>Диагностика модели</h2></hgroup><article  id="-">

<pre class = 'prettyprint lang-r'>plot(M4)</pre>

</article></slide><slide class=''><hgroup><h2>Какой из предиктов оказывает наиболее сильное влияние?</h2></hgroup><article  id="------">

<h3>Для ответа на этот вопрос надо &quot;уравнять&quot; шкалы, всех предикторов, то есть стандартизировать их.</h3>

</article></slide><slide class=''><hgroup><h2>Задание.</h2></hgroup><article  id=".">

<h3>Нпишите R-код, который позволяет стандартизировать шкалу предиктора. Стандаризируйе, например, вектор <code>fev1</code></h3>

</article></slide><slide class=''><hgroup><h2>Решение</h2></hgroup><article  id="-2">

<pre class = 'prettyprint lang-r'># 1 способ:

(cystfibr$fev1 - mean(cystfibr$fev1))/sd(cystfibr$fev1)

# 2 способ: with, чтобы меньше писать

with(cystfibr, 
  (fev1 - mean(fev1))/sd(fev1)
)

# 3 способ:

scale(cystfibr$fev1)  </pre>

<pre >##  [1] -0.2429 -1.4039 -1.1360  0.5609  1.5432  0.8288 -0.6002 -1.4932
##  [9] -0.9574 -1.0467  0.3822 -0.7788  0.9181  0.9181 -0.3322 -0.5108
## [17]  1.2753 -0.5108  0.2929 -1.2253  0.2036 -0.0643  1.9898 -0.1536
## [25]  1.5432</pre>

</article></slide><slide class=''><hgroup><h2>Можно использовать функцию <code>scale()</code></h2></hgroup><article  id="---scale">

<pre class = 'prettyprint lang-r'>M4_scaled &lt;- lm(pemax ~ scale(age) + sex + scale(bmp) + scale(fev1) + scale(rv) + 
    scale(tlc), data = cystfibr)</pre>

</article></slide><slide class=''><hgroup><h2>Какой факторов оказывает наиболее сильное влияние на усилие дыхательных мышц?</h2></hgroup><article  id="---------" class="smaller">

<pre class = 'prettyprint lang-r'>summary(M4_scaled)</pre>

<pre >## 
## Call:
## lm(formula = pemax ~ scale(age) + sex + scale(bmp) + scale(fev1) + 
##     scale(rv) + scale(tlc), data = cystfibr)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -50.45 -19.11   3.97  17.40  31.33 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   106.92       7.61   14.06  3.8e-11 ***
## scale(age)     25.49       6.55    3.89   0.0011 ** 
## sex             4.99      12.91    0.39   0.7037    
## scale(bmp)     -4.84       6.77   -0.71   0.4840    
## scale(fev1)    21.63       8.73    2.48   0.0234 *  
## scale(rv)       9.76       8.66    1.13   0.2745    
## scale(tlc)      7.89       6.87    1.15   0.2654    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 25.3 on 18 degrees of freedom
## Multiple R-squared:  0.571,  Adjusted R-squared:  0.428 
## F-statistic: 3.99 on 6 and 18 DF,  p-value: 0.0103</pre>

</article></slide><slide class=''><hgroup><h2>Задание</h2></hgroup><article  id="-1">

<h3>Оцените валидность финальной модели с помощью тестов на гетероскедастичность, автокоррелированность данных и наличие мультиколлинеарности</h3>

</article></slide><slide class=''><hgroup><h2>Оцениваем валидность финальной модели</h2></hgroup><article  id="---">

<pre class = 'prettyprint lang-r'>durbinWatsonTest(M4_scaled)</pre>

<pre >##  lag Autocorrelation D-W Statistic p-value
##    1           -0.15          2.21   0.762
##  Alternative hypothesis: rho != 0</pre>

<pre class = 'prettyprint lang-r'>bptest(M4_scaled)</pre>

<pre >## 
##  studentized Breusch-Pagan test
## 
## data:  M4_scaled
## BP = 7, df = 6, p-value = 0.3</pre>

<pre class = 'prettyprint lang-r'>vif(M4_scaled)</pre>

<pre >##  scale(age)         sex  scale(bmp) scale(fev1)   scale(rv) 
##        1.61        1.61        1.72        2.86        2.81 
##  scale(tlc) 
##        1.77</pre>

</article></slide><slide class='segue dark nobackground level1'><hgroup class = 'auto-fadein'><h2>Взаимодействия предикторов</h2></hgroup><article  id="-">

</article></slide><slide class=''><hgroup><h2>Вернемся к данным по обилию птиц и построим модель для двух предикторов</h2></hgroup><article  id="-----------" class="smaller columns-2">

<pre class = 'prettyprint lang-r'>model3 &lt;- lm(ABUND ~ YRISOL + GRAZE, data = bird)
summary(model3)</pre>

<pre >## 
## Call:
## lm(formula = ABUND ~ YRISOL + GRAZE, data = bird)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -19.469  -4.755   0.317   4.473  19.330 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -62.7491   107.3923   -0.58     0.56    
## YRISOL        0.0490     0.0542    0.90     0.37    
## GRAZE        -4.4398     0.9418   -4.71 0.000018 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.93 on 53 degrees of freedom
## Multiple R-squared:  0.474,  Adjusted R-squared:  0.454 
## F-statistic: 23.9 on 2 and 53 DF,  p-value: 0.0000000405</pre>

<pre class = 'prettyprint lang-r'>model4 &lt;- lm(ABUND ~ YRISOL * GRAZE, data = bird)
summary(model4)</pre>

<pre >## 
## Call:
## lm(formula = ABUND ~ YRISOL * GRAZE, data = bird)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -18.564  -4.300   0.961   4.050  15.378 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)   625.8955   304.2770    2.06    0.045 *
## YRISOL         -0.3028     0.1552   -1.95    0.056 .
## GRAZE        -177.1773    71.8370   -2.47    0.017 *
## YRISOL:GRAZE    0.0885     0.0368    2.40    0.020 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.6 on 52 degrees of freedom
## Multiple R-squared:  0.527,  Adjusted R-squared:  0.499 
## F-statistic: 19.3 on 3 and 52 DF,  p-value: 0.0000000155</pre>

</article></slide><slide class=''><hgroup><h2>Как трактовать взаимодействия?</h2></hgroup><article  id="--">

<p><img src="06_multiple_LM_files/figure-html/unnamed-chunk-34-1.png" width="672" style="display: block; margin: auto;" /> НО! Не всегда все так просто трактуется&#8230;<br/>Часто трактовка взаимодействий затруднительна, особенно если предкторов много.</p>

</article></slide><slide class=''><hgroup><h2>Include or Don&#39;t include? That is the question&#8230;</h2></hgroup><article  id="include-or-dont-include-that-is-the-question..." class="smaller">

<h3>Вопрос о включени в модель взаимоодействия предикторов совсем непростой</h3>

<p><em>Существует несколько подходов</em><br/>1. Не включать взаимодействия в модель. Но если при валидации модели в остатках появляется явный паттерн, то это может быть следствием наличия взаимодействия предикторов.<br/>2. Оснвываясь на априорных знаниях свойств объектов включить только те взаимоотношения, которые имеют биологический смысл.<br/>3. В процессе анализа данных выявить важные взаимодействия и включить их в анализ.<br/>4. Среди большого количества предикторов выбрать наиболее важные переменные (те, ради которых была затеяна работа). Включить в модель взаимоотношения этих предикторов с другими, менее важными, перменными.<br/>5. Включать в анализ только сами перменные (main terms) и взаимодействия первого уровня (two-way interaction terms).<br/>6. Включать в анализ и обсуждать все взаимодействия (это имеет смысл только при малом количестве предикторов).</p>

</article></slide><slide class=''><hgroup><h2>Summary</h2></hgroup><article  id="summary">

<ul class = 'build'>
<li>При построении множественной регрессии важно, помимо проверки прочих условий применимости, проверить модель на наличие мультиколлинеарности</li>
<li>Если модель построена на основе стандартизированнх значений предикторов, то можно сравнивать влияние этих прдикторов.</li>
<li>Построенную модель можно улчшать.</li>
<li>В модель можно (а иногда и необходимо) включать взаимодействия предикторов.</li>
</ul>

</article></slide><slide class=''><hgroup><h2>Что почитать</h2></hgroup><article  id="-">

<ul>
<li>Кабаков Р.И. R в действии. Анализ и визуализация данных на языке R. М.: ДМК Пресс, 2014.</li>
<li>Quinn G.P., Keough M.J. (2002) Experimental design and data analysis for biologists, pp. 92-98, 111-130</li>
<li>Diez D. M., Barr C. D., Cetinkaya-Rundel M. (2014) Open Intro to Statistics., pp. 354-367.</li>
<li>Logan M. (2010) Biostatistical Design and Analysis Using R. A Practical Guide, pp. 170-173, 208-211</li>
<li>Zuur, A.F. et al. 2009. Mixed effects models and extensions in ecology with R. - Statistics for biology and health. Springer, New York, NY. pp. 538-552.</li>
</ul></article></slide>


  <slide class="backdrop"></slide>

</slides>

<script src="site_libs/ioslides-13.5.1/js/modernizr.custom.45394.js"></script>
<script src="site_libs/ioslides-13.5.1/js/prettify/prettify.js"></script>
<script src="site_libs/ioslides-13.5.1/js/prettify/lang-r.js"></script>
<script src="site_libs/ioslides-13.5.1/js/prettify/lang-yaml.js"></script>
<script src="site_libs/ioslides-13.5.1/js/hammer.js"></script>
<script src="site_libs/ioslides-13.5.1/js/slide-controller.js"></script>
<script src="site_libs/ioslides-13.5.1/js/slide-deck.js"></script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!-- map slide visiblity events into shiny -->
<script>
  (function() {
    if (window.jQuery) {
       window.jQuery(document).on('slideleave', function(e) {
         window.jQuery(e.target).trigger('hidden');
      });
       window.jQuery(document).on('slideenter', function(e) {
         window.jQuery(e.target).trigger('shown');
      });
    }
  })();
</script>

</body>
</html>
